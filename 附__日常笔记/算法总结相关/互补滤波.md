Reading a IMU Without Kalman: The Complementary Filter   关键词。


1、http://www.olliw.eu/2013/imu-data-fusing/



* 01 如何理解 “向量间的误差，可以用向量叉积（也叫向量外积、叉乘）来表示”？两个向量直接做差不就是误差吗？

这里误差不是指向量差。这个叉积误差是指将带有误差的加计向量转动到与重力向量重合，需要绕什么轴，转多少角度。把这个叉积的三轴乘以 X%，加到陀螺的积分角度上去，就是这个 x% 互补系数的互补算法了。

实际上, 叉积的 length 是两向量夹角的正弦，而且必须在 ±90 度以内，并不完全与误差角度成线性正比。

这里的叉积算法把 sin 误差当成角度误差，并无视欧拉角的转动顺序，在误差较小的时候，并不会有影响。

因为这个修正对误差来说，是收敛的，正常情况下误差只会越来越小。


* 02 四元素 float q0 = 1, q1 = 0, q2 = 0, q3 = 0;   这四个参数的  初始值代表什么意义。值是怎么来的？

四元数 q 的初始值等同于是欧拉角为 0,0,0，根据东北天的坐标定义，也就是机体完全水平朝北。 有四元数的初始化公式, 欧拉角三个 0 度算出来就是 1,0,0,0。

代码里的初始值并没有意义，那段代码只是原理性的，离实用还有些距离。实际需要在初始化时根据加计、磁阻计算欧拉角，并初始化四元数。

误差靠什么修正？就是把原来的四元数（姿态）旋转这个误差角度。

下个周期四元数靠什么更新？也是靠陀螺的旋转积分角度去更新。

**一阶龙格库塔算法** 把 sin(x) 等同于 x、陀螺的旋转当做三个欧拉旋转、积分周期内的角速度当做匀速运动，都是微分简化的方式，有兴趣可以去研究研究锥形运动误差、转动向量法。

陀螺零点漂移修正，就是 PI 中的 I。

* 初始化，就是把 加速度计、电子罗盘的三轴结合算出的欧拉角，转换成四元数。
每个更新周期，是用陀螺仪的角速度去对四元数进行积分。
要用到欧拉角的时候，再使用 四元数 -> 欧拉角，来结算出欧拉角。
