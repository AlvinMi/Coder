

# 01
* 下面的公式把四元数转换成了方向余弦矩阵中的几个元素，再用这几个元素转换为欧拉角。------摘自惯性导航(秦永元)。就求解除了姿态！

    $\begin{equation}
    C_b^R = {
    \left[\begin{array}{ccc}
    q_0^2 + q_1^2 - q_2^2 - q_3^2  & 2*(q_1q_2 - q_0q_3) & 2*(q_1q_3 + q_0q_2) \\
    2*(q_1q_2 + q_0q_3)  & q_0^2 - q_1^2 + q_2^2 - q_3^2 & 2*(q_2q_3 - q_0q_1) \\
    2*(q_1q_3 - q_0q_2)  & 2*(q_2q_3 + q_0q_1) & q_0^2 - q_1^2 - q_2^2 + q_3^2
    \end{array}
    \right]}
    \end{equation}$

* 四元数求解欧拉角的方法： 要求 **欧拉角** 需要求得 **四元数的方向余弦矩阵**; 要求得四元数方向余弦矩阵, 需要求得 **四元数 q0~q3** 。 怎么求  **q0~q3** ？ This is a question。

    >可以先看看: [四元数与欧拉角之间的转换](http://www.cppblog.com/heath/archive/2009/12/13/103127.html)！


- [ ]  有个疑问: 为什么是四元数转换成欧拉角？( 不是说欧拉角有死锁的弊端吗？ )

[四元数和欧拉角之间的转换]( )、来自 [Wiki:Conversion between quaternions and Euler angles](https://en.wikipedia.org/wiki/Conversion_between_quaternions_and_Euler_angles)

---

- [] 加速度测得的向量为什么要进行归一化处理,

> 无论机体怎么旋转, 重力向量在世界坐标系中都是 ( 0,0,1 )。加速度计只有在自由落体时，其输出为 0。地磁向量永远是 (0,1,X)。

当机体(或者IMU)在旋转的时候, 我们重力加速度在三个轴上的分量值是无法直观的看到三个轴上的加速度分别是多少。所以需要一个**旋转矩阵**, 该矩阵的作用就是把机体坐标系中的加速度计值转换到世界坐标系中, 而在世界坐标系中三个轴上的重力向量始终都是(0,0,1)。


这个公式:

$\begin{equation}
\left[ \begin{array}{ccc}
vx \\ vy \\ vz
\end{array}
\right ] = {
\left[\begin{array}{ccc}
q_0^2 + q_1^2 - q_2^2 - q_3^2  & 2*(q_1q_2 - q_0q_3) & 2*(q_1q_3 + q_0q_2) \\
2*(q_1q_2 + q_0q_3)  & q_0^2 - q_1^2 + q_2^2 - q_3^2 & 2*(q_2q_3 - q_0q_1) \\
2*(q_1q_3 - q_0q_2)  & 2*(q_2q_3 + q_0q_1) & q_0^2 - q_1^2 - q_2^2 + q_3^2
\end{array}
\right]}\times{
\left[ \begin{array}{ccc}
0 \\ 0 \\ 1
\end{array}
\right ]}
\end{equation}$

**vx、vy、vz** 是世界坐标系重力分量 (0,0,1), 经过 DCM 旋转矩阵计算得到的机体坐标系中的重力向量。(在惯性导航--秦永元的书中有解释)。

前面提到, 无论机体怎么旋转重力向量在世界坐标系中都是 (0,0,1), 但是加速度读取到的值则是机体坐标系的, 所以要乘上一个[0,0,1]。

关于加速度和陀螺仪都是基于机体坐标系的。

进行叉积得到的误差结果近似等于当期时刻相对于上一时刻旋转的角度，这个角度即是旋转角度和预测误差角度的叠加，总称为向量误差，角度越大，误差越大。

陀螺仪积分误差和向量叉积存在正比关系。


# 参考阅读

* 01 [捷联惯导算法心得](https://www.amobbs.com/forum.php?mod=viewthread&tid=5492189&highlight=)
* 02 []()
