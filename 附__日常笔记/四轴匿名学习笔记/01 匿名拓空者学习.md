
匿名拓空者学习。

泽耀 家跟 亿百特 家产品几乎一模一样, at指令都差不多, 但是相同产品, 亿百特家的距离更远更稳定, 以前用过他们比较多产品, 亲测。

动力系统:
电机&螺旋桨: 大疆 9450浆翼、2312电机、 电调: 好盈乐天 xRotor (四旋翼不建议用天行者)、F380 机架、天地飞遥控、电池(格式) 3s~4s 3000mah、
传感器: icm20602    spl06   ak8975

海龙王航模店：
    * [沉金 F450 机架](https://item.taobao.com/item.htm?spm=a1z10.5-c-s.w4002-17502533182.28.58a9aa65w08TFb&id=39236528150)  ¥55
    * 电机2312    ¥、
    * 机架 F450
    *




加速度补偿 x,y。
磁力计只计算 z (yaw)。
# 学习计划
>目前的拓空者 [匿名拓空者室外飞行,姿态模式,气压计定高](http://v.youku.com/v_show/id_XMzIwMjM0MDQ0NA==.html?spm=a2h3j.8428770.3416059.1) 。
看了视频发现在猛打方向杆的时候会掉高, 原因应该是气压计在产生速度以后本身就会漂移, 所以会导致掉高。

## 01 基础背景
之前在知乎上看到有人推荐的 [chiplab7](https://chiplab7.taobao.com/?spm=a1z10.5-c.0.0.1a7ae1049PW4nU) 的 STM32F405 飞控, 附带一大堆学习资料、注释也很全、掌柜的也很认真负责, 买回来后再买个机架(例如 F450), 电调, 接收机和遥控, 就能按照飞控板附带的学习资料、调试软件飞起来。。 由于这家的飞控我也没买, 也就没有资料, 买了匿名的拓空者。

现在看来也和匿名的拓空者很像了。茶大也打算这版开源匿名光流、GPS 的代码, 预购了拓空者还送了匿名的(tof)激光定高模块算是福利吧, 总的来说匿名一直还是做得挺好的。

学习后的目的, 对飞控系统的基本模块：姿态解算、控制解算、混控输出、遥控器处理、嵌入式处理要明白了。

匿名、chiplab7 一样, 采取了最简单的互补滤波算法作为姿态解算模块, 然后控制解算是对欧拉角的三个角度做闭环 PID 控制。 (虽然都是基础的基础, 但也需要细心学习。)

## 02 加深理解
> 买了匿名的拓空者飞控拿到的就有气压计定高的, 效果已经在上面给出了优酷的测试视频, 非常奔放啊。这个时候还可以买个20 左右的超声波模块, 写个高度环去稳定飞控的表现。匿名之前也做过超声波定高, 但是茶大觉得效果也就那样, 现在采用匿名激光定高(ToF)模块, 也已经开源了。

这个学习的过程才是至关重要的, 高度控制来说是个比较直观理解 PID 控制的方式。

## 03 理解核心的数学和控制知识
>就算来不及学, 以后也需要去学习这些知识。

姿态解算和控制解算涉及的知识有：
- 1、刚体姿态的表示、运动学方程和动力学方程。主要是对牛顿 - 欧拉方程的认识和理解、刚体姿态的欧拉角表示法、姿态与角速度的关系等等。
这部分说复杂不复杂，说简单也不简单，可能需要学习好几个不同的书和论文以后才能搞明白的。现在看起来还是推荐从维基百科入手比较靠谱。
- 2、自动控制原理。讲 PID 的书和文章就多了去了。
- 3、线性估计基本原理。其实就是互补滤波：[Reading a IMU Without Kalman: The Complementary Filter](http://www.pieter-jan.com/node/11) 。拿这个关键词百度各种搜就会了。

## 04 重复造轮子
> 有时间可以自己画画 PCB, 可以自己从芯片开始重新画一个飞控板，读读 STM32 的芯片手册、读读各种传感器的芯片手册，自己手画一个飞控的原理图、做 PCB layout、制板自己焊元件，全套花不了 1000 块钱，能够加深很多对硬件的理解。

实在没时间、没机会也可以先不搞。 学习下实时操作系统。



---

> 记录拓空者不明白的问题。

1、在 `Pid.c` 中
    ```
    // 前馈微分和反馈微分, 求和得到微分项. (群友的回答.)
    differential = (pid_arg->kd_ex *pid_val->exp_d - pid_arg->kd_fb *pid_val->fb_d);
    ```
