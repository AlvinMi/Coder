---
title: Epson_M150 微型打印机
date: 2017-10-16 23:06:47
tags: 总结
---

这是最近接触的一个项目, 简单记录下相关的过程。 

> 项目简介, 使用 STM32 MCU 和 Epson_M150II 微型打印机, 打出字符。 相当于计价器上的针头打印出发票的信息。 

首先, 开始没有相关的参考方案, 还是先网上找了找相关的信息, 发现这个打印机头算是有点老的机型了, 早在 09 年就已经有人开始使用, 虽然没有相应的参考案例, 作为一名技术人员, 怎么能放弃呢？  

于是参考了别人的机器之后, 自己把 MCU 驱动打印机头部分的驱动模块原理图大致给 copy 下来了, 然后画出原理图后, 拿到元器件和一块洞洞板就是开干, 按照原理图焊接完成后, 用一块小的开发板来预先进行调试, 调试了一周, 结果没什么进展。 

后面没办法了, 得请教大神了, 首先检查 MCU 的基本配置是否正确, 发现中断驱动程序里有小细节没有注意, 导致中断没能触发, MCU 基本配置没问题后, 检查打印机针头输出的信号是否有信号, 信号是否正确。 由于需要检测的引脚比较多, 光靠示波器还不够, 所以用上了逻辑分析仪。 将 IO 和逻辑分析仪连接起来后, 根据打印机手册, 进行分析。 发现打印出来的时序, 在中断检测的时候被干扰到了, 第二天用示波器才检测出, 在 ULN2003 的电源引脚上对打印机针头引脚的信号造成了干扰, 打印针头的波形上产生了尖的脉冲, 从而被 MCU 外部中断检测触发, 所以时序上肯定是不对应的。解决方法就是在 ULN2003 VCC 和 GND 之间加个大电容, 选择了钽电容 47uf 10V 的进行滤波。 成功解决这个问题后, 驱动模块目前硬件上就 OK 了。 

硬件 OK, 那么就搭建起来进行驱动调试。(被这个驱动模块弄到到崩溃。) 后面调试几天驱动基本没问题了, 就继续调试上层的打印功能应用。 应用的逻辑基本也算完成, 但是仍然出现 bug, 偶尔出现打印乱码, 打印字迹不清晰的情况。

> 回想一下, 主要在打印机驱动模块卡了一下, 在中断受干扰那里卡了一下, 现在在应用层 bug 处卡着。  






